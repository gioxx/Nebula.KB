"use strict";(globalThis.webpackChunknebula=globalThis.webpackChunknebula||[]).push([[185],{3253(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"clean-mail-automation","title":"Clean Mail Automation","description":"Python IMAP mailbox cleanup automation, runnable with Docker or as a standalone script.","source":"@site/Projects/clean-mail-automation.md","sourceDirName":".","slug":"/clean-mail-automation","permalink":"/Projects/clean-mail-automation","draft":false,"unlisted":false,"tags":[{"inline":true,"label":"Projects","permalink":"/Projects/tags/projects"},{"inline":true,"label":"Python","permalink":"/Projects/tags/python"},{"inline":true,"label":"IMAP","permalink":"/Projects/tags/imap"},{"inline":true,"label":"Docker","permalink":"/Projects/tags/docker"}],"version":"current","sidebarPosition":2,"frontMatter":{"id":"clean-mail-automation","title":"Clean Mail Automation","description":"Python IMAP mailbox cleanup automation, runnable with Docker or as a standalone script.","sidebar_position":2,"tags":["Projects","Python","IMAP","Docker"]},"sidebar":"projectsSidebar","previous":{"title":"Projects: introduction","permalink":"/Projects/intro"},"next":{"title":"IntuneWinAppUtil GUI","permalink":"/Projects/M365/intunewinapputilgui"}}');var t=i(4848),l=i(8453);const s={id:"clean-mail-automation",title:"Clean Mail Automation",description:"Python IMAP mailbox cleanup automation, runnable with Docker or as a standalone script.",sidebar_position:2,tags:["Projects","Python","IMAP","Docker"]},o="Clean Mail Automation",d={},c=[{value:"Repository and images",id:"repository-and-images",level:2},{value:"Runtime options",id:"runtime-options",level:2},{value:"Core behavior",id:"core-behavior",level:2},{value:"Required environment variables",id:"required-environment-variables",level:2},{value:"Run with Docker",id:"run-with-docker",level:2},{value:"Docker Compose example",id:"docker-compose-example",level:2},{value:"Run without Docker (Python)",id:"run-without-docker-python",level:2},{value:"Scheduling and retention precedence",id:"scheduling-and-retention-precedence",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Operational notes",id:"operational-notes",level:2},{value:"License",id:"license",level:2}];function a(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"clean-mail-automation",children:"Clean Mail Automation"})}),"\n",(0,t.jsx)(n.p,{children:"Python utility that connects to an IMAP mailbox and deletes emails older than a configurable retention period. It can run in Docker (startup run + cron schedule) or directly as a standalone Python script."}),"\n",(0,t.jsx)(n.h2,{id:"repository-and-images",children:"Repository and images"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Source code: ",(0,t.jsx)(n.code,{children:"https://github.com/gioxx/clean-mail-automation"})]}),"\n",(0,t.jsxs)(n.li,{children:["Docker Hub image: ",(0,t.jsx)(n.code,{children:"gfsolone/clean-mail-automation"})]}),"\n",(0,t.jsxs)(n.li,{children:["GHCR image: ",(0,t.jsx)(n.code,{children:"ghcr.io/gioxx/clean-mail-automation"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"runtime-options",children:"Runtime options"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Dockerized execution (recommended for scheduling with embedded cron)."}),"\n",(0,t.jsx)(n.li,{children:"Standalone script execution with Python (useful for manual or external scheduler runs)."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"core-behavior",children:"Core behavior"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Connects to IMAP over SSL (",(0,t.jsx)(n.code,{children:"imaplib.IMAP4_SSL"}),") using environment variables."]}),"\n",(0,t.jsxs)(n.li,{children:["Deletes all messages in ",(0,t.jsx)(n.code,{children:"INBOX"})," older than ",(0,t.jsx)(n.code,{children:"N"})," days (",(0,t.jsx)(n.code,{children:"BEFORE <date>"})," query)."]}),"\n",(0,t.jsxs)(n.li,{children:["Executes ",(0,t.jsx)(n.code,{children:"expunge()"})," after flagging matches with ",(0,t.jsx)(n.code,{children:"\\Deleted"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Runs once immediately when container starts, then follows cron schedule."}),"\n",(0,t.jsx)(n.li,{children:"Logs to stdout/stderr (including cron output redirection to PID 1 fd)."}),"\n",(0,t.jsx)(n.li,{children:"Sends optional Telegram summary for success/failure."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"required-environment-variables",children:"Required environment variables"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{style:{textAlign:"center"},children:"Required"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"IMAP_SERVER"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"IMAP hostname or IP."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"EMAIL_USER"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Mailbox username."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"EMAIL_PASS"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"Yes"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Mailbox password/app password."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"IMAP_PORT"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"993"})}),(0,t.jsx)(n.td,{children:"IMAP SSL port."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"EMAIL_ADDRESS"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"EMAIL_USER"})}),(0,t.jsx)(n.td,{children:"Friendly mailbox identifier for logs/notifications."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"CLEAN_DAYS"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"10"})}),(0,t.jsx)(n.td,{children:"Retention in days."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TELEGRAM_BOT_TOKEN"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Telegram bot token for post-run messages."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TELEGRAM_CHAT_ID"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:"-"}),(0,t.jsx)(n.td,{children:"Telegram destination chat id."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TELEGRAM_TIMEOUT"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"10"})}),(0,t.jsx)(n.td,{children:"Telegram HTTP timeout (seconds)."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SCHEDULE_DAY"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0"})}),(0,t.jsxs)(n.td,{children:["Cron day-of-week (",(0,t.jsx)(n.code,{children:"0"}),"/",(0,t.jsx)(n.code,{children:"7"})," Sunday, ",(0,t.jsx)(n.code,{children:"1"})," Monday, ..., ",(0,t.jsx)(n.code,{children:"6"})," Saturday)."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SCHEDULE_HOUR"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0"})}),(0,t.jsxs)(n.td,{children:["Cron hour (",(0,t.jsx)(n.code,{children:"0-23"}),")."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SCHEDULE_MIN"})}),(0,t.jsx)(n.td,{style:{textAlign:"center"},children:"No"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0"})}),(0,t.jsxs)(n.td,{children:["Cron minute (",(0,t.jsx)(n.code,{children:"0-59"}),")."]})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"run-with-docker",children:"Run with Docker"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'docker run -d \\\n  --name clean-mail-automation \\\n  -e IMAP_SERVER="imap.server.com" \\\n  -e IMAP_PORT=993 \\\n  -e EMAIL_USER="your_username" \\\n  -e EMAIL_PASS="your_password" \\\n  -e EMAIL_ADDRESS="mailbox@example.com" \\\n  -e CLEAN_DAYS=10 \\\n  -e SCHEDULE_DAY=1 \\\n  -e SCHEDULE_HOUR=1 \\\n  -e SCHEDULE_MIN=30 \\\n  ghcr.io/gioxx/clean-mail-automation:latest\n'})}),"\n",(0,t.jsx)(n.p,{children:"To use Docker Hub instead of GHCR:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker run -d --name clean-mail-automation gfsolone/clean-mail-automation:latest\n"})}),"\n",(0,t.jsx)(n.h2,{id:"docker-compose-example",children:"Docker Compose example"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.code,{children:"compose.yaml"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'services:\n  clean-mail-automation:\n    image: ghcr.io/gioxx/clean-mail-automation:latest\n    container_name: clean-mail-automation\n    restart: unless-stopped\n    environment:\n      IMAP_SERVER: "imap.server.com"\n      IMAP_PORT: "993"\n      EMAIL_USER: "your_username"\n      EMAIL_PASS: "your_password"\n      EMAIL_ADDRESS: "mailbox@example.com"\n      CLEAN_DAYS: "10"\n      SCHEDULE_DAY: "1"\n      SCHEDULE_HOUR: "1"\n      SCHEDULE_MIN: "30"\n      # Optional Telegram notifications:\n      # TELEGRAM_BOT_TOKEN: "123456:ABCDEF"\n      # TELEGRAM_CHAT_ID: "123456789"\n'})}),"\n",(0,t.jsx)(n.h2,{id:"run-without-docker-python",children:"Run without Docker (Python)"}),"\n",(0,t.jsx)(n.p,{children:"Prerequisites:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Python 3.x"}),"\n",(0,t.jsx)(n.li,{children:"Network access to your IMAP server"}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Export variables and run:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'export IMAP_SERVER="imap.server.com"\nexport IMAP_PORT="993"\nexport EMAIL_USER="your_username"\nexport EMAIL_PASS="your_password"\nexport EMAIL_ADDRESS="mailbox@example.com"\nexport CLEAN_DAYS="10"\n\npython3 clean_email.py\n'})}),"\n",(0,t.jsx)(n.p,{children:"Optional retention override via CLI:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"python3 clean_email.py --days 30\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For recurring runs without Docker, schedule ",(0,t.jsx)(n.code,{children:"python3 clean_email.py"})," via your platform scheduler (",(0,t.jsx)(n.code,{children:"cron"}),", ",(0,t.jsx)(n.code,{children:"systemd timer"}),", Windows Task Scheduler)."]}),"\n",(0,t.jsx)(n.h2,{id:"scheduling-and-retention-precedence",children:"Scheduling and retention precedence"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["At container startup, ",(0,t.jsx)(n.code,{children:"entrypoint.sh"})," writes a cron entry and runs ",(0,t.jsx)(n.code,{children:"clean_email.py"})," immediately."]}),"\n",(0,t.jsxs)(n.li,{children:["Weekly schedule is controlled by ",(0,t.jsx)(n.code,{children:"SCHEDULE_DAY"}),", ",(0,t.jsx)(n.code,{children:"SCHEDULE_HOUR"}),", ",(0,t.jsx)(n.code,{children:"SCHEDULE_MIN"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Retention defaults to 10 days."}),"\n",(0,t.jsxs)(n.li,{children:["CLI override exists in script mode: ",(0,t.jsx)(n.code,{children:"python3 clean_email.py --days 30"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["If both are set, ",(0,t.jsx)(n.code,{children:"--days"})," has priority over ",(0,t.jsx)(n.code,{children:"CLEAN_DAYS"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Container logs:"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker logs clean-mail-automation\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Telegram notifications are sent only when both ",(0,t.jsx)(n.code,{children:"TELEGRAM_BOT_TOKEN"})," and ",(0,t.jsx)(n.code,{children:"TELEGRAM_CHAT_ID"})," are configured."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"operational-notes",children:"Operational notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Use mailbox-specific app passwords when available instead of primary user passwords."}),"\n",(0,t.jsx)(n.li,{children:"Test with a larger retention window first to validate query behavior in your mailbox."}),"\n",(0,t.jsxs)(n.li,{children:["Current Dockerfile uses Python ",(0,t.jsx)(n.code,{children:"3.14-slim"}),"; pin to a stable supported runtime if your platform policy requires it."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"license",children:"License"}),"\n",(0,t.jsxs)(n.p,{children:["MIT License. See ",(0,t.jsx)(n.code,{children:"LICENSE"})," in the repository."]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},8453(e,n,i){i.d(n,{R:()=>s,x:()=>o});var r=i(6540);const t={},l=r.createContext(t);function s(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);